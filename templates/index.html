{% extends "layout.html" %}
{% block title %}Alueet{% endblock %}
{% block content %}

{% if session.username %}
<hr>
TÄMÄ ON TESTI <br>
<p>Olet kirjautuneena nimellä {{ session.username }}
<br>Kirjautuneen user id on {{ session.user_id }} <br>
Kirjautunut käyttäjä on ylläpitäjä: {{ session.admin }} <br>
Kirjautunut ssaa katsella alueita: {{ session.permissions }} 
<a href="/logout">Kirjaudu ulos</a></p>
<hr>

<form action="/result" method="GET">
Hae hakusanalla: <input type="text" name="query">
<input type="submit" value="Hae">
</form>
<hr>

<h2>Alueet</h2>
{% if session.admin %}
<a href="/new_topic">Luo uusi alue</a> <br>
<hr>
{% endif %}
{% for topic in topics %}
{% if ( ( topic[2] ) or ( session.admin and not topic[2] ) or ( not session.admin and not topic[2] and topic[0] in session.permissions ) ) %}
<h3>{{ topic[1] }}</h3> <br>
Ketjuja tällä aluella: {{ topic[3] }} |
{% for comment in comments %}
{% if comment[0] == topic[0]  %}
Kommentteja tällä alueella: {{ comment[1] }} <br>
{% endif %}
{% endfor %}
<a href="/topic/{{ topic[0] }}">Tarkastele alueen ketjuja</a> |
{% if session.admin %}
<a href="/delete_topic/{{ topic[0] }}">Poista alue</a> |
{% if not topic[2] %} 
<a href="/give_permission/{{ topic[0] }}">Määritä, kuka saa tarkastella aluetta</a> |
{% endif %}
<br>
{% endif %}
{% endif %}
{% endfor %}

{% else %}

<h2>Kirjaudu sisään</h2>
<form action="/login" method="POST">
Käyttäjätunnus:<br>
<input type="text" name="username">
Salasana:<br>
<input type="password" name="password">
<input type="submit" value="Kirjaudu">
<a href="/signing_up">Eikö sinulla ole käyttäjää? Luo käyttäjä</a> <br>
{% endif %}
{% endblock%}
